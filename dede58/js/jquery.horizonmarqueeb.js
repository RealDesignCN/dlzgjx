/**
 * jQuery.horizonMarquee
 * Copyright (c) 2013 Jiang Yong
 * Licensed under MIT (http://www.opensource.org/licenses/mit-license.php) license.
 *
 * @author Jiang Yong
 * @email jiangyong.hn(at)gmail.com
 * @url https://github.com/jiangy/jquery.horizonMarquee
 * @version 0.1.0
 * @date 2013.11.30
 *
 */
;(function($) {
	$.fn.horizonMarquee = function(configs) {
		return this.each(function() {
			var settings = {
				"pre" : ".hm-pre", // ????????????????????????
				"next" : ".hm-next", // ????????????????????????
				"list" : ".hm-list", // ??????????????????????????????
				"text" : ".hm-text", // ?????????????????????????????????????????????
				"icon" : ".hm-icon", // ?????????????????????
				"iconctl" : "mouseover", // ???????????????????????????????????????mouseover??????????????????????????????click???????????????????????????????????????????????????
				"step" : 1, // ?????????????????????pre???next??????????????????????????????
				"duration" : 1000, // ????????????????????????
				"interval" : 2000, // ????????????????????????
				"autoplay" : true // ??????????????????
			};
			$.extend(settings, $.fn.horizonMarquee.defaults, configs);
			var pre = $(settings.pre, this);
			var next = $(settings.next, this);
			var list = $(settings.list, this);
			var text = $(settings.text + " > *", this);
			var icon = $(settings.icon + " > *", this);
			var num = list.children().length; // ???????????????
			var width = settings.width ? settings.width : list.children().width(); // ??????????????????
			var cur = 0; // ?????????????????????
			// ??????css??????
			list.css({"position" : "relative", "width" : num * width * 2 + "px"});
			list.parent().css({"position" : "relative", "overflow" : "hidden"});
			list.append(list.html());
			// ?????????cur????????????
			var move = function() {
				list.stop(true,false).animate({left: -cur * width + "px"}, settings.duration);
				if(text.length > cur % num)	$(text[cur%num]).show().siblings().hide();
				if(icon.length > cur % num)	$(icon[cur%num]).addClass("active").siblings().removeClass("active");
			};
			// ???????????????????????????|offSet|?????????????????????????????????????????????
			var change = function(offSet) {
				cur += offSet;
				if(cur < 0) {
					cur += num;
					list.css("left", -(cur - offSet) * width + "px");
				} else if(cur > num + offSet) {
					cur -= num;
					list.css("left", -(cur - offSet) * width + "px");
				}
				move();
			};
			// ??????????????????
			icon.each(function(index) {
				$(this).on(settings.iconctl, function() {
					if(cur >= num)	list.css("left", -(cur % num) * width + "px");
					cur = index;
					move();
					return false;
				});
			});
			// ???????????????
			pre.click(function() {change(-settings.step); return false;});
			next.click(function() {change(settings.step); return false;});
			// ????????????????????????
			var auto = function() {change(settings.step); move();};
			var ctl;
			if(settings.autoplay) {
				ctl = setInterval(auto, settings.interval);
				$(this).hover(function() {clearInterval(ctl);}, function() {ctl = setInterval(auto, settings.interval);});
			}
		}); // return end
	}; // horizonMarquee end
})(jQuery);